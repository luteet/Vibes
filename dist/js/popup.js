export default function Popup(e){let t=document.querySelector("body"),o=document.querySelector("html"),s="object"==typeof e&&!!e.saveID,i=!0,n=!0;const p=function(e,n){if(i){i=!1;let p=document.querySelector(e);if(!p)return new Error(`Not found "${e}"`);if(p.classList.contains("popup")){p.style.display="flex";document.querySelectorAll(".popup.is-active").length<=0&&o.style.setProperty("--popup-padding",window.innerWidth-t.offsetWidth+"px"),t.classList.add("is-popup-active"),s&&history.pushState("","",e),setTimeout(()=>{n?(p.classList.add("is-transition-none"),p.classList.add("is-active"),i=!0):(p.classList.add("is-active"),setTimeout(()=>{if(p.classList.contains("prototypes")){p.querySelectorAll(".prototypes__nav_list").forEach(e=>{e.closest(".prototypes__container_inner").style.setProperty("--video-y",e.getBoundingClientRect().bottom+"px")})}},200),setTimeout(()=>i=!0,1e3))},0)}}else setTimeout(()=>i=!0,1100)},l=function(e){if(n){let i;n=!1,i="string"==typeof e?document.querySelector(e):e.closest(".popup"),i.classList.contains("is-transition-none")&&i.classList.remove("is-transition-none"),setTimeout(()=>{i.classList.remove("is-active"),setTimeout((function(){const e=document.querySelectorAll(".popup.is-active");e.length<1&&!i.classList.contains("open-popup")&&(t.classList.remove("is-popup-active"),o.style.setProperty("--popup-padding","0px")),s&&(!function(){let e=window.location.toString();if(e.indexOf("#")>0){let t=e.substring(0,e.indexOf("#"));window.history.replaceState({},document.title,t)}}(),e[e.length-1]&&history.pushState("","","#"+e[e.length-1].getAttribute("id"))),n=!0,i.style.display="none"}),1e3)},0)}};return{open:function(e){p(e)},close:function(e){l(e)},init:function(){let e,o=[];if(document.querySelectorAll(".prototypes__slider").forEach(e=>{e.querySelectorAll(".prototypes__other_slider").forEach(e=>{new Splide(e,{perPage:1,gap:"1rem",speed:700,padding:{right:"3rem"},arrows:!1,pagination:!1,updateOnMove:!0}).mount()});const t=new Splide(e,{type:"fade",perPage:1,speed:700,easing:"ease",pagination:!1,drag:!1}),s=e.querySelector(".prototypes__title").querySelectorAll(".prototypes__title_slide"),i=e.querySelector(".prototypes__count"),n=e.querySelectorAll(".splide__slide").length>=10?e.querySelectorAll(".splide__slide").length:"0"+e.querySelectorAll(".splide__slide").length;t.on("move",()=>{s.forEach(e=>{e.classList.remove("is-active")}),s[t.index].classList.add("is-active");const e=t.index+1>=10?t.index+1:"0"+(t.index+1);i.textContent=`${e}/${n}`}),t.mount(),o.push(t)}),t.addEventListener("click",(function(t){e=t.target;let s=e.closest(".open-popup");s&&(t.preventDefault(),s.dataset.prototypeIndex&&o.map(e=>{e.go(Number(s.dataset.prototypeIndex)-1)}),p(s.getAttribute("href")));let i=e.closest(".popup-close");i&&l(i);const n=e.closest(".prototypes__container");n&&window.innerWidth>=992&&(e.closest("a")||e.closest(".button")||e.closest(".video_block")||l(n))})),t.addEventListener("keyup",(function(e){"Escape"==e.key&&document.querySelector(".popup.is-active")&&l(document.querySelector(".popup.is-active"))})),window.addEventListener("popstate",(function(e){e.preventDefault();let t=window.location.hash;""===t&&document.body.classList.contains("is-popup-active")?l(document.querySelector(".popup.is-active")):""===t||document.body.classList.contains("is-popup-active")||p(t,!1)})),s){let e=new URL(window.location);e.hash&&p(e.hash,!0)}}}}